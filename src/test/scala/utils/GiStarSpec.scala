package utils

import org.scalatest.{Matchers, WordSpec}
import utils.math.GiStar

class GiStarSpec extends WordSpec with Matchers
{
  val xHelper = List(1, 2, 3, 4, 5, 6, 7)
  val wHelper = List(4, 5, 6)
  "GiStar helper-functions" should
  {
    "return 4 for calcAvaerageValue(x)" in {
      GiStar.calcAverageValue(xHelper) shouldBe 4
    }
    "return 140 for calcSumX2(x)" in {
      GiStar.calcSumXToPowerOf2(xHelper) shouldBe 140
    }
    "return (s^2 =) 4 for calcStdDeviation(x)" in {
      GiStar.calcStdDeviation(xHelper) shouldBe 4
    }
    "return 77 for calcSumW2(w)" in {
      GiStar.calcSumWToPowerOf2(wHelper) shouldBe 77
    }
  }

  /*
  ---------------------------------------------------------------------------------
  |  1 |  1 |  1 |  5 |  0 |  0 |  0 |  1 |  0 |  0 |  0 |  0 |  0 |  0 |  3 |  2 |
  ---------------------------------------------------------------------------------
  |  0 |  3 |  0 |  0 |  6 |  1 |  0 |  1 |  1 |  0 |  0 |  0 |  0 |  0 |  1 |  3 |
  ---------------------------------------------------------------------------------
  |  5 |  0 |  0 |  0 |  0 |  1 |  9 |  5 |  0 |  0 |  3 |  0 |  0 |  1 |  0 |  1 |
  ---------------------------------------------------------------------------------
  |  1 |  4 |  0 |  2 |  0 |  5 |  0 |  0 |  0 |  1 |  1 |  0 |  0 |  0 |  0 |  2 |
  ---------------------------------------------------------------------------------
  |  1 |  0 |  2 |  3 |  0 |  3 |  6 |  0 |  1 |  2 |  0 |  0 |  0 |  1 |  5 |  0 |
  ---------------------------------------------------------------------------------
  |  3 |  5 |  0 |  4 |  0 |  0 |  0 |  2 |  1 |  2 |  1 |  1 |  0 |  0 |  1 |  0 |
  ---------------------------------------------------------------------------------
  |  0 |  0 |  1 |  1 |  8 |  1 |  6 |  6 |  2 |  2 |  0 |  1 |  0 |  1 |  2 |  0 |
  ---------------------------------------------------------------------------------
  |  0 |  2 |  2 |  2 |  4 |  6 | 12 |  9 |  2 |  2 |  3 |  6 |  2 |  0 |  0 |  2 |
  ---------------------------------------------------------------------------------
  |  0 |  0 |  3 |  8 |  5 |  1 |  2 |  1 |  1 |  1 |  5 |  0 |  0 |  0 |  2 |  2 |
  ---------------------------------------------------------------------------------
  |  1 |  2 |  4 |  2 |  1 |  0 |  1 |  0 |  1 |  3 |  0 |  0 |  2 |  3 |  0 |  2 |
  ---------------------------------------------------------------------------------
  |  4 |  4 |  1 |  0 |  0 |  1 |  1 |  1 |  0 |  2 |  1 |  4 |  2 |  1 |  6 |  4 |
  ---------------------------------------------------------------------------------
  |  1 |  1 |  0 |  0 |  0 |  0 |  0 |  0 |  1 |  4 |  5 |  2 |  2 |  6 |  1 |  0 |
  ---------------------------------------------------------------------------------
  |  0 |  0 |  0 |  2 |  0 |  0 |  1 |  0 |  2 |  6 |  1 |  3 |  0 |  4 |  0 |  0 |
  ---------------------------------------------------------------------------------
  |  1 |  1 |  0 |  0 |  0 |  0 |  0 |  0 |  0 |  2 |  0 |  0 | 13 |  0 |  0 |  0 |
  ---------------------------------------------------------------------------------
  |  0 |  0 |  0 |  1 |  1 |  0 |  0 |  0 |  1 |  4 |  6 |  0 |  2 |  0 |  0 |  0 |
  ---------------------------------------------------------------------------------
  |  0 |  8 |  2 |  6 |  0 |  0 |  0 |  4 |  3 |  1 |  4 |  7 |  0 |  0 |  0 |  0 |
  ---------------------------------------------------------------------------------
   */

  val X = List(
    1,1,1,5,0,0,0,1,0,0,0,0,0,0,3,2,
    0,3,0,0,6,1,0,1,1,0,0,0,0,0,1,3,
    5,0,0,0,0,1,9,5,0,0,3,0,0,1,0,1,
    1,4,0,2,0,5,0,0,0,1,1,0,0,0,0,2,
    1,0,2,3,0,3,6,0,1,2,0,0,0,1,5,0,
    3,5,0,4,0,0,0,2,1,2,1,1,0,0,1,0,
    0,0,1,1,8,1,6,6,2,2,0,1,0,1,2,0,
    0,2,2,2,4,6,12,9,2,2,3,6,2,0,0,2,
    0,0,3,8,5,1,2,1,1,1,5,0,0,0,2,2,
    1,2,4,2,1,0,1,0,1,3,0,0,2,3,0,2,
    4,4,1,0,0,1,1,1,0,2,1,4,2,1,6,4,
    1,1,0,0,0,0,0,0,1,4,5,2,2,6,1,0,
    0,0,0,2,0,0,1,0,2,6,1,3,0,4,0,0,
    1,1,0,0,0,0,0,0,0,2,0,0,13,0,0,0,
    0,0,0,1,1,0,0,0,1,4,6,0,2,0,0,0,
    0,8,2,6,0,0,0,4,3,1,4,7,0,0,0,0)
  val W = List(6, 6, 2, 12, 9, 2, 2, 1, 1)

  "GiStar" should
  {
    "return z = 4,178523 for (8, 8)" ignore {
      val n = X.length
      val avg = GiStar.calcAverageValue(X)
      val s = GiStar.calcStdDeviation(X)
      // multiplied by 1,000,000 because of floating point imprecision
      GiStar.calcZ(W, n, avg, s) * 1000000 shouldBe 4178523f
    }
  }

//   Test-Case from the original paper by Getis and Ord
//    val X = List(-0.35f, -1.62f, -0.05f, 1.86f, 2.17f, 1.67f, 0.21f, -1.03f)
//    val W = List(-0.35f, 1.86f, 2.17f, 1.67f, 0.21f)
//    "GiStar" should
//      {
//        "return z = 1.9629 for 2.17 as j" in {
//          val n = X.length
//          val avg = GiStar.calcAverageValueWithFloat(X)
//          val s = GiStar.calcStdDeviationWithFloat(X)
//          GiStar.calcZWithFloat(W, n, avg, s) shouldBe 1.9629
//        }
//      }
//  worked! (only with special float handling functions)
}